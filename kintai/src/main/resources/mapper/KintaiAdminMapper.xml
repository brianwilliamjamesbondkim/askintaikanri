<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.ascom.kintai.mapper.KintaiAdminMapper">
	<select id="getWorkInfoByDay" resultType="WorkappInfo">
		select 
			wit.workDate workDate,
			DATE_FORMAT(wit.startTime, '%H:%i:%s') startTime,
			DATE_FORMAT(wit.endTime, '%H:%i:%s') endTime,
			DATE_FORMAT(wit.restTime, '%H:%i') restTime,
			wit.workTime workTime,
			wit.workState workState,
			et.nickName nickName,
			et.email email,
			et.firstname,
			et.lastname
			
		from 
			workapp_info_table wit, 
			employee_table et
		where
			et.email = wit.email
		and
			wit.workState = #{1}
		
		and wit.workDate = #{0}
	</select>	
	
	<select id="getWorkInfoByMonth" resultType="WorkappInfo">
	<![CDATA[
		select 
			count(*) count, et.nickName nickName, et.firstname firstname, et.lastname lastname, wit.email email, DATE_FORMAT(wit.workDate, '%Y-%m') workDate,  SUM( TIME_TO_SEC( wit.workTime ) )  workTime  
		from 
			workapp_info_table wit, 
			employee_table et
		where 
			et.email = wit.email
		and
			DATE_FORMAT(wit.workDate, '%Y-%m') = #{0} 
		and 
			wit.workState != '0012'
		group by email
		having workTime  >=  ( TIME_TO_SEC(#{1})*count )
		and workTime  < (TIME_TO_SEC(#{2}) * count)
		order by workTime desc 

	]]>
	</select>
</mapper>